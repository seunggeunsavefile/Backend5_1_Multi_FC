<div th:fragment="siteHeader">
    <header class="quick-menu">
        <div class="logo"><a href="/static">Multi FC</a></div>
        <div class="header-icons">
            <button id="profile-menu-toggle" class="profile-icon" style="position: relative;">
                <i class="fas fa-user-circle"></i>
                <span id="notification-badge" class="notification-badge"></span>
            </button>
            <div id="profile-menu" class="user-menu">
                <div class="user-info">
                    <strong><span id="user-menu-username">사용자</span>님</strong>
                    <p>환영합니다!</p>
                </div>
                <ul>
                    <li><a href="/notifications" id="nav-notifications-link"><i class="fas fa-bell"></i> 알림 목록</a></li>
                    <li><a href="/mypage"><i class="fas fa-user"></i> 마이페이지</a></li>
                    <li><a href="/profile/edit"><i class="fas fa-user-edit"></i> 프로필 수정</a></li>
                    <li><a href="#" id="logout-button"><i class="fas fa-sign-out-alt"></i> 로그아웃</a></li>
                </ul>
            </div>
            <button id="menu-toggle" class="menu-toggle-btn"><i class="fas fa-bars"></i></button>
        </div>

        <nav id="main-menu" class="main-nav">
            <ul>
                <li><a href="/static" class="active"><i class="fas fa-home"></i> 메인 (Home)</a></li>
                <li><a href="/fields"><i class="fas fa-search"></i> 구장검색</a></li>
                <li><a href="/community"><i class="fas fa-users"></i> 커뮤니티</a></li>
                <li id="nav-chat-link-li"><a href="/chat" id="nav-chat-link"><i class="fas fa-comments"></i> 실시간채팅</a></li>
                <li><a href="/schedule?stadium"><i class="fas fa-calendar-check"></i> 경기 일정</a></li>
            </ul>
        </nav>
    </header>

    <!-- ✅ 헤더용 JS를 fragment 안에서 로드 -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 헤더 관련 요소들
            const menuToggle = document.getElementById('menu-toggle');
            const mainMenu = document.getElementById('main-menu');
            const profileMenuToggle = document.getElementById('profile-menu-toggle');
            const profileMenu = document.getElementById('profile-menu');
            const logoutButton = document.getElementById('logout-button');
            const navNotificationsLink = document.getElementById('nav-notifications-link');
            const navLogoutLink = document.getElementById('nav-logout-link');   // 있으면 동작, 없으면 무시
            const navChatLinkElement = document.getElementById('nav-chat-link');
            const badge = document.getElementById('notification-badge');

            // 메뉴 토글
            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    mainMenu.classList.toggle('show');
                    profileMenu.classList.remove('show');
                });
            }
            if (profileMenuToggle) {
                profileMenuToggle.addEventListener('click', () => {
                    profileMenu.classList.toggle('show');
                    mainMenu.classList.remove('show');
                });
            }

            // 바깥 클릭 시 닫기
            document.addEventListener('click', (event) => {
                if (
                    mainMenu &&
                    profileMenu &&
                    !mainMenu.contains(event.target) &&
                    !menuToggle.contains(event.target) &&
                    !profileMenu.contains(event.target) &&
                    !profileMenuToggle.contains(event.target)
                ) {
                    mainMenu.classList.remove('show');
                    profileMenu.classList.remove('show');
                }
            });

            // 로그아웃 (드롭다운 안의 버튼)
            if (logoutButton) {
                logoutButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('username');
                    localStorage.removeItem('hasReadReviews');
                    localStorage.removeItem('hasReadSchedules');
                    window.location.href = '/login';
                });
            }

            // (만약 상단 어딘가에 nav-logout-link가 따로 있다면)
            if (navLogoutLink) {
                navLogoutLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('hasReadReviews');
                    localStorage.removeItem('hasReadSchedules');
                    window.location.href = '/login';
                });
            }

            // 채팅 메뉴: 비로그인 시 로그인 유도
            if (navChatLinkElement) {
                navChatLinkElement.addEventListener('click', function (e) {
                    const accessToken = localStorage.getItem('accessToken');
                    if (!accessToken) {
                        e.preventDefault();
                        alert("로그인이 필요한 서비스입니다.");
                        window.location.href = '/login';
                    }
                });
            }

            // badge 변수는 여기서만 쓰면 됨 (전역 공유 안 해도 되면 이 안에서만 사용)
        });
    </script>
</div>
